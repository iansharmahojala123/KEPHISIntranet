@model IEnumerable<KEPHISIntranet.Models.Announcement>

@{
    ViewData["Title"] = "All Announcements";
    bool isPrivilegedUser = User.IsInRole("Admin") || User.IsInRole("Communications");
}

<style>
    .table, .table th, .table td, .form-control, .btn {
        font-size: 1.1rem;
    }

    h2 {
        font-size: 1.75rem;
    }

    .btn i {
        margin-right: 4px;
    }
</style>

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">All Announcements</h2>
        @if (isPrivilegedUser)
        {
            <a href="@Url.Action("Create", "Announcements")" class="btn btn-success px-4 py-2">
                <i class="fa fa-plus"></i> New Announcement
            </a>
        }
    </div>

    <div class="mb-3">
        <input type="text" id="searchInput" onkeyup="filterTable()" class="form-control" placeholder="Search announcements...">
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-secondary text-center">
            No announcements available at the moment.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-bordered table-striped shadow-sm" id="announcementTable">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 220px;">Date</th>
                        <th style="width: auto;">Announcement</th>
                        @if (isPrivilegedUser)
                        {
                            <th style="width: 220px;">Actions</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var ann in Model)
                    {
                        <tr style="height: 100px;">
                            <td class="align-middle">
                                @ann.DateCreated.ToString("dd MMM yyyy • hh:mm tt")
                            </td>
                            <td class="align-middle">
                                @ann.AnnouncementText
                            </td>
                            @if (isPrivilegedUser)
                            {
                                <td class="align-middle">
                                    <a href="@Url.Action("Edit", "Announcements", new { id = ann.ID })" class="btn btn-sm btn-warning me-2">
                                        <i class="fa fa-edit"></i> Edit
                                    </a>
                                    <a href="@Url.Action("Delete", "Announcements", new { id = ann.ID })" class="btn btn-sm btn-danger">
                                        <i class="fa fa-trash"></i> Delete
                                    </a>
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@section Scripts {
    <script>
        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toLowerCase();
            const table = document.getElementById("announcementTable");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                let show = false;
                const td = tr[i].getElementsByTagName("td");
                for (let j = 0; j < td.length; j++) {
                    if (td[j] && td[j].innerText.toLowerCase().includes(filter)) {
                        show = true;
                        break;
                    }
                }
                tr[i].style.display = show ? "" : "none";
            }
        }
    </script>
}
